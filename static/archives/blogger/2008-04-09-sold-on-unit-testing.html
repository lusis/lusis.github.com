--- 
name: sold-on-unit-testing
layout: post
title: Sold on unit testing
time: 2008-04-09 16:24:00 -04:00
---
I'll tell anyone who asks that I'm NOT a programmer. I've always understood the value in unit tests but considered them somewhat limited in scope. I mean it's pretty much impossible to write a unit test for every possible scenario and (IMHO) impossible to write a unit test that simulates the flow of a user from application login to data entry to logout using the entire infrastructure (i.e. client browser -> through load balancer -> through app server -> database -> back).<br /><br />Because of those reasons, while I understood the need for unit tests for "stupid stuff", the fact that you had to add unit tests for each bug that popped up over the life of a product felt "odd". Of course this wouldn't stop me from bitching at a developer who's lack of a unit test caused me to restore a filesystem because it would ascend to the parent directory if the file or directory it was trying to delete did not exist! (True story).<br /><br />So here I am writing my ruby nagios library and realizing that I'm duplicating A LOT of code writing quick little scripts to test my output. I decide to write unit tests for each of my classes.  I found an interesting little article on about.com talking about learning ruby via unit tests. It was an interesting concept and one that made sense to me. So I start with my contact class.<br /><br />Basically all of the classes that exist for a specific nagios object (contact,service,host) have their own class. One method they have is called "hashify". It's different for each object type but essentially creates a nested hash like so:<br /><pre><br />{<br />"nagiosadmin"=><br />{"service_notification_period"=>"24x7",<br />"host_notification_options"=>"d,u,r",<br />"service_notifications_enabled"=>nil,<br />"host_notification_enabled"=>nil,<br />"pager"=>nil,<br />"service_notification_commands"=>"notify-service-by-email",<br />"host_notification_period"=>"24x7",<br />"alias"=>"Nagios Admin",<br />"host_notification_commands"=>"notify-host-by-email",<br />"service_notification_options"=>"w,u,c,r",<br />"email"=>"root@localhost"},<br />"johnv"=><br />{"service_notification_period"=>"24x7",<br />"host_notification_options"=>"d,u,r",<br />"service_notifications_enabled"=>nil,<br />"host_notification_enabled"=>nil,<br />"pager"=>nil,<br />"service_notification_commands"=>"notify-service-by-email",<br />"host_notification_period"=>"24x7",<br />"alias"=>"John E. Vincent",<br />"host_notification_commands"=>"notify-host-by-email",<br />"service_notification_options"=>"w,u,c,r",<br />"email"=>"root@localhost"}<br />}<br /></pre>So I start writing unit tests. I test that hashify returns a Hash. I test that I have a hash called 'johnv'. Then I start testing for each of the attributes for johnv. This is where it all falls apart. Attribute email is always returning nil even though I can see right in the debugger that it's set to 'root@localhost'.<br /><br />After about 30 minutes of dicking around I finally realize that, being a Ruby beginner who has used some of the higher-level Ruby stuff for quickies without actually getting into the meat of the language (Rails, Ruport), I was totally confused on the usage of ":" in hashes much less anywhere else in Ruby. Two minutes after that, I stopped throwing symbols all over the place in my classes when building a hash ;)<br /><br />My unit test passed! I continue to write the remaining tests and run them. I get a failure. I look in detail and realize that in my original Contact class, I had a typo in the hashify method that defined a key as 'host_notification<span style="font-weight: bold;">s</span>_period' instead of 'host_notification_period'!<br /><br />So yeah, I'm sold on unit tests and I'm not writing another lick of code until I finish writing them for the classes I have now.<div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/934985301455705990-6697283957816888469?l=lusislog.blogspot.com' alt='' /></div>
